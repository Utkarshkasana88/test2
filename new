import io.opentelemetry.api.GlobalOpenTelemetry
import io.opentelemetry.api.common.Attributes
import io.opentelemetry.api.trace.Tracer
import io.opentelemetry.sdk.autoconfigure.AutoConfiguredOpenTelemetrySdk

object DatabricksOtelApp {

  def main(args: Array[String]): Unit = {

    println("Initializing OpenTelemetry via Azure autoconfigure")

    AutoConfiguredOpenTelemetrySdk.initialize()

    val tracer: Tracer =
      GlobalOpenTelemetry.getTracer("databricks-scala-service")

    val span = tracer.spanBuilder("test-span").startSpan()

    span.addEvent(
      "custom-event",
      Attributes.builder()
        .put("source", "databricks")
        .put("type", "test")
        .build()
    )

    Thread.sleep(200)
    span.end()

    println("Span + event sent to Application Insights")
    Thread.sleep(5000) // allow export
  }
}
